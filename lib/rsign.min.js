(function (a) { a.fn.extend({ getImage: function (b, c) { var d = this[0]; if (b) { b = b.toLowerCase() } else { b = "png" } if (!c || c < 0) { c = 1 } if (b.indexOf("png") != -1) { return d.toDataURL("image/png") } else { return d.toDataURL("image/jpeg", c) } }, getFillRate: function () { var e = this[0]; var f = e.getContext("2d"); var b = f.getImageData(0, 0, e.width, e.height).data; var d = 0; for (var c = 0, d = 0; c < b.length; c += 4) { if (b[c] || b[c + 1] || b[c + 2] || b[c + 3]) { d++ } } return d / (e.width * e.height) }, clearCanvas: function (b) { var c = this[0]; var d = c.getContext("2d"); d.beginPath(); d.clearRect(0, 0, c.width, c.height); if (b) { d.fillStyle = b; d.fillRect(0, 0, c.width, c.height) } d.closePath() }, rsign: function (i) { var b = this; var n = { lineWidth: 5, strokeColor: "black", bgColor: null, shadowBlur: 1, shadowColor: "black" }; a.extend(n, i); var j = b[0]; var k = j.getContext("2d"); var l, m; var h = false; function c() { k.beginPath(); if (n.bgColor) { k.fillStyle = n.bgColor; k.fillRect(0, 0, j.width, j.height) } else { k.clearRect(0, 0, j.width, j.height) } k.closePath() } j.clear = c; j.getImage = function (o, p) { if (o) { o = o.toLowerCase() } else { o = "png" } if (!p || p < 0) { p = 1 } if (o.indexOf("png") != -1) { return j.toDataURL("image/png") } else { return j.toDataURL("image/jpeg", p) } }; function g() { var o = k.getImageData(0, 0, j.width, j.height).data; var q = 0; for (var p = 0, q = 0; p < o.length; p += 4) { if (o[p] || o[p + 1] || o[p + 2] || o[p + 3]) { q++ } } return q / (j.width * j.height) } j.getFillRate = g; function d(o) { o.preventDefault(); if (o.originalEvent && o.originalEvent.changedTouches) { o = o.originalEvent.changedTouches[o.originalEvent.changedTouches.length - 1] } k.beginPath(); var p = b.offset().left, q = b.offset().top; l = o.pageX - p; m = o.pageY - q; h = true } function f(o) { o.preventDefault(); h = false; k.closePath() } function e(o) { o.preventDefault(); if (h) { if (o.originalEvent && o.originalEvent.changedTouches) { o = o.originalEvent.changedTouches[o.originalEvent.changedTouches.length - 1] } var p = b.offset().left, q = b.offset().top; var r = o.pageX - p, s = o.pageY - q; k.moveTo(l, m); k.lineTo(r, s); k.lineCap = "round"; k.lineJoin = "round"; k.strokeStyle = n.strokeColor; k.lineWidth = n.lineWidth; k.shadowBlur = n.shadowBlur; k.shadowColor = n.shadowColor; k.stroke(); l = r; m = s } } b.unbind(); b.on("touchstart", d); b.on("touchend", f); b.on("touchmove", e); b.on("mousedown", d); b.on("mouseup", f); b.on("mousemove", e) } }) })(jQuery);