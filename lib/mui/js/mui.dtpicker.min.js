(function(a,b){a.dom=function(e){if(typeof(e)!=="string"){if((e instanceof Array)||(e[0]&&e.length)){return[].slice.call(e)}else{return[e]}}if(!a.__create_dom_div__){a.__create_dom_div__=b.createElement("div")}a.__create_dom_div__.innerHTML=e;return[].slice.call(a.__create_dom_div__.childNodes)};var c='<div class="mui-dtpicker" data-type="datetime">		<div class="mui-dtpicker-header">			<button data-id="btn-cancel" class="mui-btn">取消</button>			<button data-id="btn-ok" class="mui-btn mui-btn-blue">确定</button>		</div>		<div class="mui-dtpicker-title"><h5 data-id="title-y">年</h5><h5 data-id="title-m">月</h5><h5 data-id="title-d">日</h5><h5 data-id="title-h">时</h5><h5 data-id="title-i">分</h5></div>		<div class="mui-dtpicker-body">			<div data-id="picker-y" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>			<div data-id="picker-m" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>			<div data-id="picker-d" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>			<div data-id="picker-h" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>			<div data-id="picker-i" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>		</div>	</div>';var d=a.DtPicker=a.Class.extend({init:function(f){var g=this;var e=a.dom(c)[0];b.body.appendChild(e);a('[data-id*="picker"]',e).picker();var h=g.ui={picker:e,mask:a.createMask(),ok:a('[data-id="btn-ok"]',e)[0],cancel:a('[data-id="btn-cancel"]',e)[0],y:a('[data-id="picker-y"]',e)[0],m:a('[data-id="picker-m"]',e)[0],d:a('[data-id="picker-d"]',e)[0],h:a('[data-id="picker-h"]',e)[0],i:a('[data-id="picker-i"]',e)[0],labels:a('[data-id*="title-"]',e),};h.cancel.addEventListener("tap",function(){g.hide()},false);h.ok.addEventListener("tap",function(){var i=g.callback(g.getSelected());if(i!==false){g.hide()}},false);h.y.addEventListener("change",function(){g._createDay()},false);h.m.addEventListener("change",function(){g._createDay()},false);h.mask[0].addEventListener("tap",function(){g.hide()},false);g._create(f);g.ui.picker.addEventListener("touchstart",function(i){i.preventDefault()},false);g.ui.picker.addEventListener("touchmove",function(i){i.preventDefault()},false)},getSelected:function(){var f=this;var h=f.ui;var g=f.options.type;var e={type:g,y:h.y.picker.getSelectedItem(),m:h.m.picker.getSelectedItem(),d:h.d.picker.getSelectedItem(),h:h.h.picker.getSelectedItem(),i:h.i.picker.getSelectedItem(),toString:function(){return this.value}};switch(g){case"datetime":e.value=e.y.value+"-"+e.m.value+"-"+e.d.value+" "+e.h.value+":"+e.i.value;e.text=e.y.text+"-"+e.m.text+"-"+e.d.text+" "+e.h.text+":"+e.i.text;break;case"date":e.value=e.y.value+"-"+e.m.value+"-"+e.d.value;e.text=e.y.text+"-"+e.m.text+"-"+e.d.text;break;case"time":e.value=e.h.value+":"+e.i.value;e.text=e.h.text+":"+e.i.text;break;case"month":e.value=e.y.value+"-"+e.m.value;e.text=e.y.text+"-"+e.m.text;break;case"hour":e.value=e.y.value+"-"+e.m.value+"-"+e.d.value+" "+e.h.value;e.text=e.y.text+"-"+e.m.text+"-"+e.d.text+" "+e.h.text;break}return e},setSelectedValue:function(h){var f=this;var g=f.ui;var e=f._parseValue(h);g.y.picker.setSelectedValue(e.y,0);g.m.picker.setSelectedValue(e.m,0);g.d.picker.setSelectedValue(e.d,0);g.h.picker.setSelectedValue(e.h,0);g.i.picker.setSelectedValue(e.i,0)},isLeapYear:function(e){return(e%4==0&&e%100!=0)||(e%400==0)},_inArray:function(f,h){for(var g in f){var e=f[g];if(e===h){return true}}return false},getDayNum:function(g,e){var f=this;if(f._inArray([1,3,5,7,8,10,12],e)){return 31}else{if(f._inArray([4,6,9,11],e)){return 30}else{if(f.isLeapYear(g)){return 29}else{return 28}}}},_fill:function(e){e=e.toString();if(e.length<2){e=0+e}return e},_createYear:function(e){var g=this;var f=g.options;var h=g.ui;var j=[];if(f.customData.y){j=f.customData.y}else{var k=f.beginYear;var l=f.endYear;for(var i=k;i<=l;i++){j.push({text:i+"",value:i})}}h.y.picker.setItems(j)},_createMonth:function(e){var i=this;var h=i.options;var j=i.ui;var g=[];if(h.customData.m){g=h.customData.m}else{for(var f=1;f<=12;f++){var k=i._fill(f);g.push({text:k,value:k})}}j.m.picker.setItems(g)},_createDay:function(e){var j=this;var i=j.options;var k=j.ui;var g=[];if(i.customData.d){g=i.customData.d}else{var h=j.getDayNum(parseInt(k.y.picker.getSelectedValue()),parseInt(k.m.picker.getSelectedValue()));for(var f=1;f<=h;f++){var l=j._fill(f);g.push({text:l,value:l})}}k.d.picker.setItems(g);e=e||k.d.picker.getSelectedValue()},_createHours:function(e){var j=this;var i=j.options;var k=j.ui;var g=[];if(i.customData.h){g=i.customData.h}else{for(var f=0;f<=23;f++){var l=j._fill(f);g.push({text:l,value:l})}}k.h.picker.setItems(g)},_createMinutes:function(e){var j=this;var h=j.options;var k=j.ui;var g=[];if(h.customData.i){g=h.customData.i}else{for(var f=0;f<=59;f++){var l=j._fill(f);g.push({text:l,value:l})}}k.i.picker.setItems(g)},_setLabels:function(){var f=this;var e=f.options;var g=f.ui;g.labels.each(function(h,j){j.innerText=e.labels[h]})},_setButtons:function(){var f=this;var e=f.options;var g=f.ui;g.cancel.innerText=e.buttons[0];g.ok.innerText=e.buttons[1]},_parseValue:function(i){var h=this;var g={};if(i){var f=i.replace(":","-").replace(" ","-").split("-");g.y=f[0];g.m=f[1];g.d=f[2];g.h=f[3];g.i=f[4]}else{var e=new Date();g.y=e.getFullYear();g.m=e.getMonth()+1;g.d=e.getDate();g.h=e.getHours();g.i=e.getMinutes()}return g},_create:function(f){var g=this;f=f||{};f.labels=f.labels||["年","月","日","时","分"];f.buttons=f.buttons||["取消","确定"];f.type=f.type||"datetime";f.customData=f.customData||{};g.options=f;var e=new Date();f.beginYear=f.beginYear||(e.getFullYear()-5);f.endYear=f.endYear||(e.getFullYear()+5);var h=g.ui;g._setLabels();g._setButtons();h.picker.setAttribute("data-type",f.type);g._createYear();g._createMonth();g._createDay();g._createHours();g._createMinutes();g.setSelectedValue(f.value)},show:function(e){var f=this;var g=f.ui;f.callback=e||a.noop;g.mask.show();b.body.classList.add(a.className("dtpicker-active-for-page"));g.picker.classList.add(a.className("active"));f.__back=a.back;a.back=function(){f.hide()}},hide:function(){var e=this;if(e.disposed){return}var f=e.ui;f.picker.classList.remove(a.className("active"));f.mask.close();b.body.classList.remove(a.className("dtpicker-active-for-page"));a.back=e.__back},dispose:function(){var e=this;e.hide();setTimeout(function(){e.ui.picker.parentNode.removeChild(e.ui.picker);for(var f in e){e[f]=null;delete e[f]}e.disposed=true},300)}})})(mui,document);